{% extends 'orders/header.html' %}
{% load static %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&amp;display=swap" rel="stylesheet">
<div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg,#fcf4f5, #f5e3d1 );">
    <div style="font-family: 'Playfair Display', serif; margin: 20px auto; text-align: center; max-width: 650px; background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);">
        <!-- Page Title -->
        <h1 style="color: #573c2a; font-size: 3em; margin-bottom: 20px;">
            Scan QR Code to Redirect
        </h1>
        
        
         
        <div style="padding: 20px; border-radius: 15px; background:#604e4287; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
           
            <p style="font-size: 1.2em; color: #f0edde; margin-bottom: 20px;">
                Align your QR code within the frame to scan and be redirected.
            </p>
            <div id="reader" style="width: 300px; height: 300px; border: 2px dashed #573c2a; border-radius: 10px; background: whitesmoke; margin: 0 auto;"></div>
        </div>

        <!-- Footer -->
        
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode@latest/minified/html5-qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gyb4fQ5Pa5T0UcYEh7z7r1D7f3q5pjt1z8eG1zebhndNW+gR9g" crossorigin="anonymous"></script>

<script>
    // Ensure the script only runs after the library is loaded
    window.onload = () => {
        console.log('Page Loaded!');
        if (typeof Html5QrcodeScanner !== 'undefined') {
            let html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", 
                { fps: 10, qrbox: 250 },
                false
            );
            html5QrcodeScanner.render(onScanSuccess, onScanFailure);
        } else {
            console.error('Html5QrcodeScanner is not defined.');
        }
    };

    function onScanSuccess(decodedText, decodedResult) {
    console.log(`Scanned URL: ${decodedText}`);
    alert(`Redirecting to: ${decodedText}`);
    window.location.href = decodedText;
}
    function onScanFailure(error) {
        console.warn(`Scan failed: ${error}`);
    }
</script>
{% endblock %}
